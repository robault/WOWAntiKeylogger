<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Windows hooks detector « Prekageo’s Blog</title>

<link rel="stylesheet" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/style.css" type="text/css" media="screen">
<!--[if lte IE 8]><link rel="stylesheet" href="http://s0.wp.com/wp-content/themes/pub/kubrick/ie.css?m=1273203575g" type="text/css" media="screen" /><![endif]-->
<link rel="pingback" href="http://shiftlock.wordpress.com/xmlrpc.php">

<meta name="google-site-verification" content="SwTObFOGK2bLBK4v__h7bzMNLYAE1W3oeeQIUL1Dn5M">
<link rel="alternate" type="application/rss+xml" title="Prekageo's Blog » Feed" href="http://shiftlock.wordpress.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Prekageo's Blog » Comments Feed" href="http://shiftlock.wordpress.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Prekageo's Blog » Windows hooks&nbsp;detector Comments Feed" href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/feed/">
<script type="text/javascript" async="" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/quant.js"></script><script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<link rel="stylesheet" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/global.css" type="text/css">
<link rel="stylesheet" id="loggedout-subscribe-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/widget.css" type="text/css" media="all">
<link rel="stylesheet" id="post-reactions-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/style_002.css" type="text/css" media="all">
<link rel="stylesheet" id="a8c-global-print-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/global-print.css" type="text/css" media="print">
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/jquery.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/widget.js"></script>
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/comment-reply.js"></script>
<link rel="stylesheet" id="highlander-comments-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/style_003.css" type="text/css" media="all">
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='http://s0.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1307172283g&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://shiftlock.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://shiftlock.wordpress.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Moore state machine solver and&nbsp;optimizer" href="http://shiftlock.wordpress.com/2011/05/17/moore-state-machine-solver-and-optimizer/">
<link rel="next" title="Windows XP: My monitor does not turn off for power&nbsp;saving" href="http://shiftlock.wordpress.com/2011/06/26/windows-xp-my-monitor-does-not-turn-off-for-power-saving/">
<meta name="generator" content="WordPress.com">
<link rel="canonical" href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/">
<link rel="shortlink" href="http://wp.me/pstDw-5q">
<link rel="alternate" type="application/json+oembed" href="http://public-api.wordpress.com/oembed/1.0/?format=json&amp;url=http%3A%2F%2Fshiftlock.wordpress.com%2F2011%2F06%2F22%2Fwindows-hooks-detector%2F&amp;for=wpcom-auto-discovery"><link rel="alternate" type="application/xml+oembed" href="http://public-api.wordpress.com/oembed/1.0/?format=xml&amp;url=http%3A%2F%2Fshiftlock.wordpress.com%2F2011%2F06%2F22%2Fwindows-hooks-detector%2F&amp;for=wpcom-auto-discovery"><meta property="og:type" content="article">
<meta property="og:title" content="Windows hooks&nbsp;detector">
<meta property="og:url" content="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/">
<meta property="og:description" content="Recently, I had to fix a problem with Microsoft Office Word. The problem was that the normal key combination Alt-Shift for changing the input language was not working. After some time I discovered ...">
<meta property="og:site_name" content="Prekageo's Blog">
<link rel="shortcut icon" type="image/x-icon" href="http://s2.wp.com/i/favicon.ico?m=1311976026g" sizes="16x16 24x24 32x32 48x48">
<link rel="icon" type="image/x-icon" href="http://s2.wp.com/i/favicon.ico?m=1311976026g" sizes="16x16 24x24 32x32 48x48">
<link rel="apple-touch-icon-precomposed" href="http://s0.wp.com/i/webclip.png?m=1311618091g">
<link rel="openid.server" href="http://shiftlock.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="http://shiftlock.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="http://shiftlock.wordpress.com/osd.xml" title="Prekageo's Blog">
<link rel="search" type="application/opensearchdescription+xml" href="http://wordpress.com/opensearch.xml" title="WordPress.com">
<style type="text/css"><!--
body { background: url("http://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgcolor.gif?m=1273203575g"); }
#page { background: url("http://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickbgwide.gif?m=1273203575g") repeat-y top !important; border: none; }
#header { background: url("http://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickheader.gif?m=1273203575g") no-repeat bottom center; }
#footer { background: url("http://s0.wp.com/wp-content/themes/pub/kubrick/images/kubrickfooter.gif?m=1273203575g") no-repeat bottom; border: none;}
#header { margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px; }
#headerimg { margin: 7px 9px 0; height: 192px; width: 740px; }
#headerimg h1 a, #headerimg h1 a:visited, #headerimg .description { color: ; }
#headerimg h1 a, #headerimg .description { display:  }

	--></style><meta name="application-name" content="Prekageo's Blog"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="Just another WordPress.com weblog"><meta name="msapplication-task" content="name=Subscribe;action-uri=http://shiftlock.wordpress.com/feed/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico">
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/google_service.js">
</script>
<script type="text/javascript">
GS_googleAddAdSenseService("ca-pub-3443918307802676");
GS_googleEnableAllServices();
</script>
<script type="text/javascript">
GA_googleAddSlot("ca-pub-3443918307802676", "wpcom_below_post");
</script>
<script type="text/javascript">
GA_googleFetchAds();
</script>
<script type="text/javascript"> 
	window.google_analytics_uacct = "UA-52447-2"; 
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script><script src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/ga.js" async="" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" id="gravatar-card-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/hovercard.css"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/services.css"></head>
<body class="single single-post postid-336 single-format-standard highlander-enabled highlander-light">
<div id="page">

<div id="header">
	<div id="headerimg" onclick=" location.href='http://shiftlock.wordpress.com';" style="cursor: pointer;">
		<h1><a href="http://shiftlock.wordpress.com/">Prekageo’s Blog</a></h1>
		<div class="description">Just another WordPress.com weblog</div>
	</div>
</div>
<hr>

	<div id="content" class="widecolumn">

	
		<div class="navigation">
			<div class="alignleft">« <a href="http://shiftlock.wordpress.com/2011/05/17/moore-state-machine-solver-and-optimizer/" rel="prev">Moore state machine solver and&nbsp;optimizer</a></div>
			<div class="alignright"><a href="http://shiftlock.wordpress.com/2011/06/26/windows-xp-my-monitor-does-not-turn-off-for-power-saving/" rel="next">Windows XP: My monitor does not turn off for power&nbsp;saving</a> »</div>
		</div>

		<div class="post-336 post type-post status-publish format-standard hentry category-uncategorized clear" id="post-336">
						<h2>Windows hooks&nbsp;detector</h2>
			<small class="single-by"></small>

			<div class="entry">
				<p>Recently, I had to fix a problem with Microsoft Office Word. The 
problem was that the normal key combination Alt-Shift for changing the 
input language was not working. After some time I discovered that the 
culprit was a rather old piece of software that had installed some 
Windows hooks targeted at the Microsoft Office Word, which (probably) 
stopped the propagation of the Alt-Shift key combination before it could
 actually change the language.</p>
<p>While I was investigating this issue, I noticed that there was no 
available utility that could detect and report installed Windows hooks. 
So here I present a Windows hooks detector. It is a command line 
application accompanied by a system driver, that scans, detects and 
reports installed Windows hooks. The source code and the binary compiled
 for Windows XP is available here: <a href="http://labpower.teipir.gr/prekageo/hook_detect.zip">Windows hooks detector</a>.</p>
<p>Also you can download a demo hook application, that installs local 
and global hooks for testing purposes. The source code and the binary is
 available here: <a href="http://labpower.teipir.gr/prekageo/hook_demo.zip">Demo Windows hook application</a></p>
<p><span id="more-336"></span></p>
<p>According to the <a href="http://msdn.microsoft.com/en-us/library/ms632589">MSDN documentation for Windows hooks</a>:</p>
<blockquote><p>
a hook is a point in the system message-handling mechanism where an 
application can install a subroutine to monitor the message traffic in 
the system and process certain types of messages before they reach the 
target window procedure.
</p></blockquote>
<p>A Windows hook is installed by calling <a href="http://msdn.microsoft.com/en-us/library/ms644990">SetWindowsHookEx</a> (<a href="http://blog.csdn.net/uvbs/archive/2008/08/06/2778911.aspx">source code</a>) and removed by calling <a href="http://msdn.microsoft.com/en-us/library/ms644993">UnhookWindowsHookEx</a>.
 It can either be installed globally or locally. When it is installed 
globally it intercepts messages for all threads belonging to the same 
desktop. When it is installed locally it intercepts messages directed to
 a specific thread.</p>
<p>The Windows API does not offer any way for an application to list the
 installed hooks. After a hook is installed, it is stored and managed 
inside kernel structures which cannot be accessed from the user mode. 
Thus a kernel driver is necessary to access these structures. 
Furthermore, the whole mechanism of installing, handling and removing 
hooks is undocumented, which means that there is need to reverse 
engineer the relevant code. So after spending some time with the <a href="http://www.hex-rays.com/idapro/">IDA Pro Disassembler</a>, <a href="http://en.wikipedia.org/wiki/SoftICE">SoftICE</a> and a Windows XP image running on <a onclick="return mugicPopWin(this,event);" oncontextmenu="mugicRightClick(this);" href="http://www.vmware.com/">VMware</a> the job was done.</p>
<p>An overview for detecting installed global hooks follows:</p>
<ol>
<li>Call <a href="http://msdn.microsoft.com/en-us/library/ff559936%28v=vs.85%29.aspx">PsGetCurrentThread</a> and get the <a href="http://msdn.microsoft.com/en-us/library/ff544319%28v=vs.85%29.aspx">ETHREAD</a> structure of the current thread. ETHREAD is an opaque data structure according to the MSDN documentation.</li>
<li>Extract the <a href="http://blog.csdn.net/coffeemay/archive/2006/09/18/1238777.aspx">THREADINFO</a> structure by calling PsGetThreadWin32Thread. Both of them are undocumented.</li>
<li>Extract the DESKTOPINFO.</li>
<li>There you can a find all the globally installed hooks. They are 
organized in a array. Each element is a linked list and corresponds to a
 specific hook (WH_*).</li>
</ol>
<p>An overview for detecting installed local hooks follows:</p>
<ol>
<li>Given a thread ID.</li>
<li>Call <a href="http://msdn.microsoft.com/en-us/library/ff551925%28v=VS.85%29.aspx">PsLookupThreadByThreadId</a> and get the ETHREAD structure of the specified thread.</li>
<li>Extract the THREADINFO structure by calling PsGetThreadWin32Thread.</li>
<li>There you can a find all the locally installed hooks for the 
specified thread. They are organized in a array. Each element is a 
linked list and corresponds to a specific hook (WH_*).</li>
</ol>
<p>Each hook is represented by a HOOK structure, which is undocumented. 
The HOOK structure stores the virtual address of the handler function. 
If the handler resides inside a DLL, then the relative virtual address 
is stored and the DLL path is stored in an atom table. That’s because a 
DLL’s base address may be different across processes. Also, by storing 
the DLL path in the atom table, the system knows which DLL to load if 
the hook is triggered inside a new process. We could say that the hook 
DLL is lazily loaded into processes.</p>
<p>Unfortunately, this atom table is internal. Also, there is no 
exported function of the kernel that accesses it. So the only way to 
read its contents is to call directly non-exported and undocumented 
kernel function calls. In order to get the necessary addresses, the 
utility uses the <a href="http://msdn.microsoft.com/en-us/library/ms679309%28v=VS.85%29.aspx">Debug Help Library</a> to load the <a href="http://en.wikipedia.org/wiki/Program_database">PDB</a> of win32k.sys. Two symbols are needed:</p>
<ul>
<li>UserGetAtomName: A function that reads the above mentioned internal atom table.</li>
<li>aatomSysLoaded: An array containing the atoms of hook DLLs. The necessary offset in this array is stored in the HOOK structure.</li>
</ul>
<p>The utility has been tested with the following versions of 
win32k.sys: 5.1.2600.2180, 5.1.2600.2770, 5.1.2600.5512. These versions 
correspond to Windows XP SP2 and SP3. If you don’t have one of those 
versions and the utility crashes your system, please send me your 
win32k.sys for analysis. Otherwise, please inform me in order to update 
the supported versions.</p>
<p>There is one more way to get the DLL path for a hook, although it is 
less reliable, so I haven’t implemented it. Though, I am going to 
describe it. After loading a hook DLL the system stores in the 
PROCESSINFO structure the base address of the loaded DLL. So if the hook
 DLL is loaded in the inspected process, you can retrieve its base 
address and from the base address after traversing the module list of 
the process you can find the DLL path. If the hook DLL has not been 
loaded yet, then you are out of luck.</p>
<p>If you would like to compile the utility you need the <a href="http://msdn.microsoft.com/en-us/windows/hardware/gg487428">Windows Driver Kit (WDK)</a> and <a href="http://www.hollistech.com/Resources/ddkbuild/ddkbuild.htm">ddkbuild</a>.</p>

<div class="wpadvert" style="text-align: center; padding: 5px; background: #; padding: 5px; margin: 10px auto;">
<script type="text/javascript">
GA_googleAddAttr("AdOpt", "1");
GA_googleAddAttr("Origin", "extsearch");
GA_googleAddAttr("theme_bg", "ffffff"); 
GA_googleAddAttr("theme_text", "333333"); 
GA_googleAddAttr("theme_link", "0066cc"); 
GA_googleAddAttr("theme_border", "f9f9f9"); 
GA_googleAddAttr("theme_url", "114477"); 
GA_googleAddAttr("LangId", "1");
GA_googleAddAttr("Domain", "shiftlock.wordpress.com");
GA_googleAddAttr("Autotag", "technology");

GA_googleFillSlot("wpcom_below_post");
</script>
</div><div id="jp-post-flair" class="sharedaddy sd-like-enabled"><div class="wpl-likebox sd-block sd-like"><h3 class="sd-title">Like this:</h3><div class="sd-content"><div id="like-336" class="wpl-button "><a href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/?like=1&amp;_wpnonce=022440814f" title="I like this post" class="like needs-login sd-button" rel="nofollow"><span>Like</span></a></div><div class="wpl-count sd-like-count">Be the first to like this post.</div></div></div></div>
								
				<p class="postmetadata alt">
					<small>
												This entry was posted on June 22, 2011 at 3:07 pm and is filed under <a href="http://shiftlock.wordpress.com/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>.						You can follow any responses to this entry through the <a href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/feed/">RSS 2.0</a> feed.
													You can <a href="#respond">leave a response</a>, or <a href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/trackback/" rel="trackback">trackback</a> from your own site.
						
					</small>
				</p>

			</div>
					</div>

	
<!-- You can start editing here. -->



								<div class="js" id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/#respond" style="display: none;">Cancel reply</a></small></h3>
									<form action="http://shiftlock.wordpress.com/wp-comments-post.php" method="post" id="commentform">
																										


												
<input name="hc_post_as" id="hc_post_as" value="guest" type="hidden">

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea tabindex="-1" style="height: 37px; resize: none; overflow-y: hidden; position: absolute; top: 0px; left: -9999px; width: 428px; line-height: 17px; text-decoration: none; letter-spacing: normal;"></textarea><textarea style="height: 37px; resize: none; overflow-y: hidden;" id="comment" name="comment"></textarea></div>
</div>

<div style="display: none;" id="comment-form-identity">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/ad516503a11cd5ca435acc9bb6523536_002.png" alt="Gravatar" class="no-grav" width="25">
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="text"></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text"></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text"></div>
				</div> 
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/wplogo.png" alt="WordPress.com Logo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" type="hidden">
				<input name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" type="hidden">
				<input name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" type="hidden">
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'wordpress'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Twitter picture" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" type="hidden">
				<input name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" type="hidden">
				<input name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" type="hidden">
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'twitter'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Facebook photo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" type="hidden">
				<input name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" type="hidden">
				<input name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" type="hidden">
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'facebook'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>
	
	
</div>


<div style="display: none;" id="comment-form-subscribe"> 
	<p class="comment-subscription-form"><input name="subscribe" id="subscribe" value="subscribe" style="width: auto;" tabindex="6" type="checkbox"> <label class="subscribe-label" id="subscribe-label" for="subscribe">Notify me of follow-up comments via email.</label></p><p class="post-subscription-form"><input name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;" tabindex="7" type="checkbox"> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog">Notify me of new posts via email.</label></p></div>

<script type="text/javascript">
jQuery(document).ready(function(){
	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();
	jQuery( '#comment' ).css( { 'height':'10px' } ).one( 'focus', function() {
		jQuery( this ).animate( { 'height':'70px' } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
});
</script>
												<p style="display: none;" class="form-submit">
							<input name="submit" id="comment-submit" value="Post Comment" type="submit">
							<input name="comment_post_ID" value="336" id="comment_post_ID" type="hidden">
<input name="comment_parent" id="comment_parent" value="0" type="hidden">
						</p>
						
<input name="genseq" value="1337516096" type="hidden">
<p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="c9793f5553" type="hidden"></p><script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/form.js"></script>
<p style="display: none;"><input id="ak_js" name="ak_js" value="1337516096017" type="hidden"></p>					</form>
							</div><!-- #respond -->
			<div style="clear: both"></div>			

	
	</div>


<hr>
<div id="footer">
	<p>
		Theme: <a href="http://theme.wordpress.com/themes/kubrick/" title="Learn more about this theme">Kubrick</a>. <a href="http://wordpress.com/?ref=footer" rel="generator">Blog at WordPress.com</a>.
		<br><a href="http://shiftlock.wordpress.com/feed/">Entries (RSS)</a> and <a href="http://shiftlock.wordpress.com/comments/feed/">Comments (RSS)</a>.	</p>
</div>
</div>

<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/gprofiles.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/wpgroho.js"></script>

<script type="text/javascript">
var _qevents = _qevents || [], wpcomQuantcastData = {"qacct":"p-18-mFEk4J448M","labels":",language.en,type.wpcom,as"};
function wpcomQuantcastPixel( labels, options ) {
	var i, defaults = wpcomQuantcastData, data = { event: 'ajax' };

	labels  = labels  || '';
	options = options || {};

	if ( typeof labels != 'string' )
		options = labels;

	for ( i in defaults ) {
		data[i] = defaults[i];
	}

	for ( i in options ) {
		data[i] = options[i];
	}

	if ( data.labels ) {
		data.labels += ',' + labels;
	} else {
		data.labels = labels;
	}

	_qevents.push( data );
};
(function() {var elem = document.createElement('script');elem.src = (document.location.protocol == "https:" ? "https://secure" : "http://edge") + ".quantserve.com/quant.js";elem.async = true;elem.type = "text/javascript";var scpt = document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(elem, scpt);  })();
_qevents.push( wpcomQuantcastData );
</script>
<noscript><div style="display: none;"><img src="//pixel.quantserve.com/pixel/p-18-mFEk4J448M.gif?labels=%2Clanguage.en%2Ctype.wpcom%2Cas" height="1" width="1" alt="" /></div></noscript>


	<script type="text/javascript">
	/* <![CDATA[ */
	(function($){
		$(document).on( 'ready post-load', function() {

			// Remove the login box when clicking the page
			$( document ).mousedown( function( e ) {
				if ( null == $( e.target ).closest( '#wpl-mustlogin' ).get( 0 ) ) {
					$( '#wpl-mustlogin' ).remove();
				}
			});

			// Handle clicking the like button itself
			$('.wpl-button > a.like').click( function(e) {
				e.preventDefault();

				var postid = $(this).parent().attr('id').split('like-')[1];
				$.post( 'http://shiftlock.wordpress.com/wp-admin/admin-ajax.php', {
					'action': 'wpl_record_stat',
					'stat_name': 'loggedout_like_click'
				} );

				var tenMins = new Date();
				tenMins.setTime( tenMins.getTime() + 600000 );
				document.cookie = 'wpl_rand=6b9a03496b; expires=' + tenMins.toGMTString() + '; domain=wordpress.com; path=/;';

				$(this).parent().siblings('.wpl-count').after( '\
					<div id="wpl-mustlogin"> \
						<form action="https://shiftlock.wordpress.com/wp-login.php" method="post"> \
							<p>Just one more step to like this:</p> \
							<label><span>Username</span> <input type="text" name="log" id="user_login" class="input" value="" size="20" tabindex="80" /></label> \
							<label><span>Password</span> <input type="password" name="pwd" id="user_pass" class="input" value="" size="20" tabindex="81" /></label> \
							<input type="submit" name="wp-submit" id="wp-submit" class="button-primary" value="Log In" tabindex="82" /> \
							<input type="hidden" name="postid" value="' + postid + '" /> \
							<input type="hidden" name="redirect_to" value="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector?year=2011&monthnum=06&day=22&name=windows-hooks-detector&like=1" /> \
							<input type="hidden" name="wpl_rand" value="6b9a03496b" /> \
							<p>Not a member yet? <a href="http://wordpress.com/signup/?ref=likebox" id="wpl-signup-link">Sign up with WordPress.com</a></p> \
						</form> \
					</div> \
				');

				$('#wpl-mustlogin').hide().slideDown('fast');
			} );

			$('#wpl-mustlogin input.input').live( 'focus', function() {
				$(this).prev().hide();
			}).live( 'blur', function() {
				if ( $(this).val() == '' ) {
					$(this).prev().show();
				}
			});

			$('#wpl-mustlogin input#wp-submit').live( 'click', function(e) {
				e.preventDefault();

				$.post( 'http://shiftlock.wordpress.com/wp-admin/admin-ajax.php', {
					'action': 'wpl_record_stat',
					'stat_name': 'loggedout_login_submit'
				}, function() {
					$('#wpl-mustlogin form').submit();
				} );
			});

			$('#wpl-mustlogin a#wpl-signup-link').live( 'click', function(e) {
				e.preventDefault();

				var link = $(this).attr('href');

				$.post( 'http://shiftlock.wordpress.com/wp-admin/admin-ajax.php', {
					'action': 'wpl_record_stat',
					'stat_name': 'loggedout_signup_click'
				}, function() {
					location.href = link;
				} );
			});
		})
	})(jQuery);
	/* ]]> */
	</script>
<script>jQuery(document).ready(function($){ Gravatar.profile_cb = function( h, d ) { WPGroHo.syncProfileData( h, d );	}; Gravatar.my_hash = WPGroHo.my_hash; Gravatar.init( 'body', '#wp-admin-bar-my-account' ); });</script>	<div style="display:none">
	</div>
		<style type="text/css">
			
				.reblog-from img                   { margin: 0 10px 0 0; vertical-align: middle; padding: 0; border: 0; }
				.reblogger-note img.avatar         { float: left; padding: 0; border: 0; }
				.reblogger-note-content            { margin: 0 0 20px 35px; }
				.reblog-post                       { border-left: 3px solid #eee; padding-left: 15px; }
				.reblog-post ul.thumb-list         { display: block; list-style: none; margin: 2px 0; padding: 0; clear: both; }
				.reblog-post ul.thumb-list li      { display: inline; margin: 0; padding: 0 1px; border: 0; }
				.reblog-post ul.thumb-list li a    { margin: 0; padding: 0; border: 0; }
				.reblog-post ul.thumb-list li img  { margin: 0; padding: 0; border: 0; }
				.reblog-post                       { border-left: 3px solid #eee; padding-left: 15px; }

				.reblog-post .wpcom-enhanced-excerpt { clear: both; }

				.reblog-post .wpcom-enhanced-excerpt address,
				.reblog-post .wpcom-enhanced-excerpt li,
				.reblog-post .wpcom-enhanced-excerpt h1,
				.reblog-post .wpcom-enhanced-excerpt h2,
				.reblog-post .wpcom-enhanced-excerpt h3,
				.reblog-post .wpcom-enhanced-excerpt h4,
				.reblog-post .wpcom-enhanced-excerpt h5,
				.reblog-post .wpcom-enhanced-excerpt h6,
				.reblog-post .wpcom-enhanced-excerpt p { font-size: 100% !important; }

				.reblog-post .wpcom-enhanced-excerpt blockquote,
				.reblog-post .wpcom-enhanced-excerpt pre,
				.reblog-post .wpcom-enhanced-excerpt code,
				.reblog-post .wpcom-enhanced-excerpt q { font-size: 98% !important; }
					</style><script type="text/javascript">
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"http:\/\/shiftlock.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"http:\/\/shiftlock.wordpress.com\/wp-login.php?action=logout&_wpnonce=251a870d34","homeURL":"http:\/\/shiftlock.wordpress.com\/","postID":"336","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":""};
/* ]]> */
</script>
<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/script.js"></script>
	
	<div style="bottom: -237px;" id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id="bsub-text">Follow</span></a>
		<div id="bitsubscribe">
			
					<h3><label for="loggedout-follow-field">Follow “Prekageo's Blog”</label></h3>
		
			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>
			
			<p id="loggedout-follow-error" style="display: none;"></p>

					
			
			<p><input name="email" style="width: 95%; padding: 1px 2px;" value="Enter your email address" onfocus='this.value=(this.value=="Enter your email address") ? "" : this.value;' onblur='this.value=(this.value=="") ? "Enter email address" : this.value;' id="loggedout-follow-field" type="text"></p>

			<input name="action" value="subscribe" type="hidden">
			<input name="blog_id" value="6787110" type="hidden">
			<input name="source" value="http://shiftlock.wordpress.com/2011/06/22/windows-hooks-detector/" type="hidden">
			<input name="sub-type" value="loggedout-follow" type="hidden">

			<input id="_wpnonce" name="_wpnonce" value="d70a14ce7f" type="hidden"><input name="_wp_http_referer" value="/2011/06/22/windows-hooks-detector/" type="hidden">
			<p id="bsub-subscribe-button"><input value="Sign me up" type="submit"></p>
			</form>
					<div id="bsub-credit"><a href="http://wordpress.com/signup/?ref=lof">Powered by WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->

	<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/wordpress.js"></script> 
	<script type="text/javascript">
		var skimlinks_pub_id = "725X584219"
		var skimlinks_sitename = 'shiftlock.wordpress.com';
		skimlinks();
	</script> 		
	<script type="text/javascript" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/beacon.js"></script><script type="text/javascript">try{COMSCORE.beacon({c1:2,c2:7518284});}catch(e){}</script><noscript><p class="robots-nocontent"><img src="http://b.scorecardresearch.com/p?cj=1c1=2&#038;c2=7518284" alt="" style="display:none" width="1" height="1" /></p></noscript><script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/w.js" type="text/javascript"></script>
<script type="text/javascript">
st_go({'blog':'6787110','v':'wpcom','user_id':'0','post':'336','subd':'shiftlock'});
ex_go({'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRVz1bVXI0VlprLSUzeVU4NGZjTyxlUEFFOTV+b2MmJUNHdTJ5c1U5LDYwciYtMiUzNV9XNjFEVGpBOSxobkR6JUxjNUZuVmMlSz9LUjJXS1N+Z2lqTlNpLEddQmZmY1hBfkIxcGktLnFHTUs4T2pZTFg5cEZ4Xy8/bmZXdG8xckljSW5kbC5DaW05U0c2SVNBTy0mdld3T3RaTFk1Z3gsek03WXRJanQ1cVUlPWJ0ekE2TS5XMlY2N050SVssN0RjN2o9TDcsZjZ4L0g9UG5xX01nK0FkZEVoTWdUcytZVy1ZK05qUGNxVHMuRlAyR3NnTU1BdHB5V1hQc353NFQ0SDRPNzhH'});
addLoadEvent(function(){linktracker_init('6787110',336);});
	</script><img id="wpstats" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/g.gif" alt=""><img id="wpstats2" src="Windows%20hooks%20detector%20%C2%AB%20Prekageo%E2%80%99s%20Blog_files/g_002.gif" alt="" style="display: none;">
<noscript><img src="http://stats.wordpress.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>


</body></html>